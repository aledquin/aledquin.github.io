#!/bin/bash
############################################################################
# File       : ddr-icvwb
# Author     : Ahmed Hesham(ahmedhes)
# Date       : 01/11/2023
# Description: Loads the ICVWB module with the ddr-icvwb_loader sourced into it.
#              The ICVWB version can be specified using the -version option
############################################################################

toolName="ddr-da-$(basename ${BASH_SOURCE:-$0})"
toolPath=$(realpath $(dirname ${BASH_SOURCE:-$0}))
toolVersion=$($toolPath/da_get_release_version.pl)

/remote/cad-rep/msip/tools/bin/msip_get_usage_info --tool_name $toolName --tool_path $toolPath --tool_version $toolVersion --stage main --category ude_ext_1 >& /dev/null &
input_args=""
for ((i=1;i<=$#;i++)); do
    if [ ${!i} = "-version" ]; then
        ((i++))
        version=${!i};
    else
        input_args="${input_args} ${!i}"
    fi
done

source /global/etc/sh.bashrc
module unload icvwb
if [ -z $version ]; then
    module load icvwb
else
    module load icvwb/$version
fi

loader_script=$(dirname ${BASH_SOURCE:-$0})/ddr-icvwb_loader.tcl
icvwb -run $loader_script $input_args
